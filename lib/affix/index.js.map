{"version":3,"sources":["affix/index.jsx"],"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","getDefaultTarget","window","AffixStatus","Affix","state","status","None","lastAffix","savePlaceholderNode","node","placeholderNode","saveFixedNode","fixedNode","measure","props","offset","offsetBottom","onChange","Prepare","offsetTop","undefined","targetNode","newState","targetRect","placeholderReact","top","affixStyle","position","width","height","placeholderStyle","bottom","targetBottomOffset","innerHeight","setState","renderAffix","getPrefixCls","prefixCls","style","children","className","process","env","NODE_ENV","mergedPlaceholderStyle","updatePosition","timeout","setTimeout","prevProps","clearTimeout","cancel","e","onTestUpdatePosition","React","Component","defaultProps","prototype"],"mappings":"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","sourcesContent":["var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nimport * as React from 'react';\nimport { polyfill } from 'react-lifecycles-compat';\nimport classNames from 'classnames';\nimport omit from 'omit.js';\nimport { ConfigConsumer } from '../config-provider';\nimport { throttleByAnimationFrameDecorator } from '../_util/throttleByAnimationFrame';\nimport ResizeObserver from '../_util/resizeObserver';\nimport warning from '../_util/warning';\nimport { addObserveTarget, removeObserveTarget, getTargetRect } from './utils';\nfunction getDefaultTarget() {\n    return typeof window !== 'undefined' ? window : null;\n}\nvar AffixStatus;\n(function (AffixStatus) {\n    AffixStatus[AffixStatus[\"None\"] = 0] = \"None\";\n    AffixStatus[AffixStatus[\"Prepare\"] = 1] = \"Prepare\";\n})(AffixStatus || (AffixStatus = {}));\nclass Affix extends React.Component {\n    constructor() {\n        super(...arguments);\n        this.state = {\n            status: AffixStatus.None,\n            lastAffix: false,\n        };\n        this.savePlaceholderNode = (node) => {\n            this.placeholderNode = node;\n        };\n        this.saveFixedNode = (node) => {\n            this.fixedNode = node;\n        };\n        this.measure = () => {\n            const { status, lastAffix } = this.state;\n            const { target, offset, offsetBottom, onChange } = this.props;\n            if (status !== AffixStatus.Prepare || !this.fixedNode || !this.placeholderNode || !target) {\n                return;\n            }\n            let { offsetTop } = this.props;\n            if (typeof offsetTop === 'undefined') {\n                offsetTop = offset;\n                warning(typeof offset === 'undefined', 'Affix', '`offset` is deprecated. Please use `offsetTop` instead.');\n            }\n            if (offsetBottom === undefined && offsetTop === undefined) {\n                offsetTop = 0;\n            }\n            const targetNode = target();\n            if (!targetNode) {\n                return;\n            }\n            const newState = {\n                status: AffixStatus.None,\n            };\n            const targetRect = getTargetRect(targetNode);\n            const placeholderReact = getTargetRect(this.placeholderNode);\n            if (offsetTop !== undefined && targetRect.top > placeholderReact.top - offsetTop) {\n                newState.affixStyle = {\n                    position: 'fixed',\n                    top: offsetTop + targetRect.top,\n                    width: placeholderReact.width,\n                    height: placeholderReact.height,\n                };\n                newState.placeholderStyle = {\n                    width: placeholderReact.width,\n                    height: placeholderReact.height,\n                };\n            }\n            else if (offsetBottom !== undefined &&\n                targetRect.bottom < placeholderReact.bottom + offsetBottom) {\n                const targetBottomOffset = targetNode === window ? 0 : window.innerHeight - targetRect.bottom;\n                newState.affixStyle = {\n                    position: 'fixed',\n                    bottom: offsetBottom + targetBottomOffset,\n                    width: placeholderReact.width,\n                    height: placeholderReact.height,\n                };\n                newState.placeholderStyle = {\n                    width: placeholderReact.width,\n                    height: placeholderReact.height,\n                };\n            }\n            newState.lastAffix = !!newState.affixStyle;\n            if (onChange && lastAffix !== newState.lastAffix) {\n                onChange(newState.lastAffix);\n            }\n            this.setState(newState);\n        };\n        // =================== Render ===================\n        this.renderAffix = ({ getPrefixCls }) => {\n            const { affixStyle, placeholderStyle, status } = this.state;\n            const { prefixCls, style, children } = this.props;\n            const className = classNames({\n                [getPrefixCls('affix', prefixCls)]: affixStyle,\n            });\n            let props = omit(this.props, ['prefixCls', 'offsetTop', 'offsetBottom', 'target', 'onChange']);\n            // Omit this since `onTestUpdatePosition` only works on test.\n            if (process.env.NODE_ENV === 'test') {\n                props = omit(props, ['onTestUpdatePosition']);\n            }\n            const mergedPlaceholderStyle = Object.assign({}, (status === AffixStatus.None ? placeholderStyle : null), style);\n            return (<div {...props} style={mergedPlaceholderStyle} ref={this.savePlaceholderNode}>\n        <div className={className} ref={this.saveFixedNode} style={this.state.affixStyle}>\n          <ResizeObserver onResize={this.updatePosition}>{children}</ResizeObserver>\n        </div>\n      </div>);\n        };\n    }\n    // Event handler\n    componentDidMount() {\n        const { target } = this.props;\n        if (target) {\n            // [Legacy] Wait for parent component ref has its value.\n            // We should use target as directly element instead of function which makes element check hard.\n            this.timeout = setTimeout(() => {\n                addObserveTarget(target(), this);\n                // Mock Event object.\n                this.updatePosition({});\n            });\n        }\n    }\n    componentDidUpdate(prevProps) {\n        const { target } = this.props;\n        if (prevProps.target !== target) {\n            removeObserveTarget(this);\n            if (target) {\n                addObserveTarget(target(), this);\n                // Mock Event object.\n                this.updatePosition({});\n            }\n        }\n        if (prevProps.offsetTop !== this.props.offsetTop ||\n            prevProps.offsetBottom !== this.props.offsetBottom) {\n            this.updatePosition({});\n        }\n        this.measure();\n    }\n    componentWillUnmount() {\n        clearTimeout(this.timeout);\n        removeObserveTarget(this);\n        this.updatePosition.cancel();\n    }\n    // =================== Measure ===================\n    // Handle realign logic\n    // @ts-ignore TS6133\n    updatePosition(e) {\n        // event param is used before. Keep compatible ts define here.\n        this.setState({\n            status: AffixStatus.Prepare,\n            affixStyle: undefined,\n            placeholderStyle: undefined,\n        });\n        // Test if `updatePosition` called\n        if (process.env.NODE_ENV === 'test') {\n            const { onTestUpdatePosition } = this.props;\n            if (onTestUpdatePosition) {\n                onTestUpdatePosition();\n            }\n        }\n    }\n    render() {\n        return <ConfigConsumer>{this.renderAffix}</ConfigConsumer>;\n    }\n}\nAffix.defaultProps = {\n    target: getDefaultTarget,\n};\n__decorate([\n    throttleByAnimationFrameDecorator()\n], Affix.prototype, \"updatePosition\", null);\npolyfill(Affix);\nexport default Affix;\n"],"file":"index.js"}