{"version":3,"sources":["anchor/Anchor.jsx"],"names":["getDefaultContainer","window","getOffsetTop","element","container","getClientRects","length","rect","getBoundingClientRect","width","height","ownerDocument","documentElement","top","clientTop","easeInOutCubic","t","b","c","d","cc","sharpMatcherRegx","scrollTo","href","offsetTop","getContainer","callback","scrollTop","sharpLinkMatch","exec","targetElement","document","getElementById","eleOffsetTop","targetScrollTop","startTime","Date","now","frameFunc","timestamp","time","nextScrollTop","pageXOffset","Anchor","arguments","state","activeLink","links","handleScroll","animating","props","bounds","setState","getCurrentAnchor","handleScrollTo","link","updateInk","prefixCls","anchorNode","ReactDOM","findDOMNode","linkNode","getElementsByClassName","inkNode","style","clientHeight","saveInkNode","node","renderAnchor","getPrefixCls","customizePrefixCls","className","affix","showInkInFixed","children","inkClass","visible","wrapperClass","anchorClass","fixed","wrapperStyle","maxHeight","anchorContent","antAnchor","registerLink","includes","push","unregisterLink","index","indexOf","splice","onClick","scrollEvent","remove","linkSections","forEach","toString","target","maxSection","reduce","prev","curr","React","Component","defaultProps","childContextTypes","PropTypes","object"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport * as PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport addEventListener from 'rc-util/lib/Dom/addEventListener';\nimport Affix from '../affix';\nimport { ConfigConsumer } from '../config-provider';\nimport getScroll from '../_util/getScroll';\nimport raf from 'raf';\nfunction getDefaultContainer() {\n    return window;\n}\nfunction getOffsetTop(element, container) {\n    if (!element) {\n        return 0;\n    }\n    if (!element.getClientRects().length) {\n        return 0;\n    }\n    const rect = element.getBoundingClientRect();\n    if (rect.width || rect.height) {\n        if (container === window) {\n            container = element.ownerDocument.documentElement;\n            return rect.top - container.clientTop;\n        }\n        return rect.top - container.getBoundingClientRect().top;\n    }\n    return rect.top;\n}\nfunction easeInOutCubic(t, b, c, d) {\n    const cc = c - b;\n    t /= d / 2;\n    if (t < 1) {\n        return (cc / 2) * t * t * t + b;\n    }\n    return (cc / 2) * ((t -= 2) * t * t + 2) + b;\n}\nconst sharpMatcherRegx = /#([^#]+)$/;\nfunction scrollTo(href, offsetTop = 0, getContainer, callback = () => { }) {\n    const container = getContainer();\n    const scrollTop = getScroll(container, true);\n    const sharpLinkMatch = sharpMatcherRegx.exec(href);\n    if (!sharpLinkMatch) {\n        return;\n    }\n    const targetElement = document.getElementById(sharpLinkMatch[1]);\n    if (!targetElement) {\n        return;\n    }\n    const eleOffsetTop = getOffsetTop(targetElement, container);\n    const targetScrollTop = scrollTop + eleOffsetTop - offsetTop;\n    const startTime = Date.now();\n    const frameFunc = () => {\n        const timestamp = Date.now();\n        const time = timestamp - startTime;\n        const nextScrollTop = easeInOutCubic(time, scrollTop, targetScrollTop, 450);\n        if (container === window) {\n            window.scrollTo(window.pageXOffset, nextScrollTop);\n        }\n        else {\n            container.scrollTop = nextScrollTop;\n        }\n        if (time < 450) {\n            raf(frameFunc);\n        }\n        else {\n            callback();\n        }\n    };\n    raf(frameFunc);\n}\nexport default class Anchor extends React.Component {\n    constructor() {\n        super(...arguments);\n        this.state = {\n            activeLink: null,\n        };\n        this.links = [];\n        this.handleScroll = () => {\n            if (this.animating) {\n                return;\n            }\n            const { offsetTop, bounds } = this.props;\n            this.setState({\n                activeLink: this.getCurrentAnchor(offsetTop, bounds),\n            });\n        };\n        this.handleScrollTo = (link) => {\n            const { offsetTop, getContainer } = this.props;\n            this.animating = true;\n            this.setState({ activeLink: link });\n            scrollTo(link, offsetTop, getContainer, () => {\n                this.animating = false;\n            });\n        };\n        this.updateInk = () => {\n            if (typeof document === 'undefined') {\n                return;\n            }\n            const prefixCls = this.prefixCls;\n            const anchorNode = ReactDOM.findDOMNode(this);\n            const linkNode = anchorNode.getElementsByClassName(`${prefixCls}-link-title-active`)[0];\n            if (linkNode) {\n                this.inkNode.style.top = `${linkNode.offsetTop + linkNode.clientHeight / 2 - 4.5}px`;\n            }\n        };\n        this.saveInkNode = (node) => {\n            this.inkNode = node;\n        };\n        this.renderAnchor = ({ getPrefixCls }) => {\n            const { prefixCls: customizePrefixCls, className = '', style, offsetTop, affix, showInkInFixed, children, getContainer, } = this.props;\n            const { activeLink } = this.state;\n            const prefixCls = getPrefixCls('anchor', customizePrefixCls);\n            // To support old version react.\n            // Have to add prefixCls on the instance.\n            // https://github.com/facebook/react/issues/12397\n            this.prefixCls = prefixCls;\n            const inkClass = classNames(`${prefixCls}-ink-ball`, {\n                visible: activeLink,\n            });\n            const wrapperClass = classNames(className, `${prefixCls}-wrapper`);\n            const anchorClass = classNames(prefixCls, {\n                fixed: !affix && !showInkInFixed,\n            });\n            const wrapperStyle = Object.assign({ maxHeight: offsetTop ? `calc(100vh - ${offsetTop}px)` : '100vh' }, style);\n            const anchorContent = (<div className={wrapperClass} style={wrapperStyle}>\n        <div className={anchorClass}>\n          <div className={`${prefixCls}-ink`}>\n            <span className={inkClass} ref={this.saveInkNode}/>\n          </div>\n          {children}\n        </div>\n      </div>);\n            return !affix ? (anchorContent) : (<Affix offsetTop={offsetTop} target={getContainer}>\n        {anchorContent}\n      </Affix>);\n        };\n    }\n    getChildContext() {\n        const antAnchor = {\n            registerLink: (link) => {\n                if (!this.links.includes(link)) {\n                    this.links.push(link);\n                }\n            },\n            unregisterLink: (link) => {\n                const index = this.links.indexOf(link);\n                if (index !== -1) {\n                    this.links.splice(index, 1);\n                }\n            },\n            activeLink: this.state.activeLink,\n            scrollTo: this.handleScrollTo,\n            onClick: this.props.onClick,\n        };\n        return { antAnchor };\n    }\n    componentDidMount() {\n        const { getContainer } = this.props;\n        this.scrollEvent = addEventListener(getContainer(), 'scroll', this.handleScroll);\n        this.handleScroll();\n    }\n    componentWillUnmount() {\n        if (this.scrollEvent) {\n            this.scrollEvent.remove();\n        }\n    }\n    componentDidUpdate() {\n        this.updateInk();\n    }\n    getCurrentAnchor(offsetTop = 0, bounds = 5) {\n        const activeLink = '';\n        if (typeof document === 'undefined') {\n            return activeLink;\n        }\n        const linkSections = [];\n        const { getContainer } = this.props;\n        const container = getContainer();\n        this.links.forEach(link => {\n            const sharpLinkMatch = sharpMatcherRegx.exec(link.toString());\n            if (!sharpLinkMatch) {\n                return;\n            }\n            const target = document.getElementById(sharpLinkMatch[1]);\n            if (target) {\n                const top = getOffsetTop(target, container);\n                if (top < offsetTop + bounds) {\n                    linkSections.push({\n                        link,\n                        top,\n                    });\n                }\n            }\n        });\n        if (linkSections.length) {\n            const maxSection = linkSections.reduce((prev, curr) => (curr.top > prev.top ? curr : prev));\n            return maxSection.link;\n        }\n        return '';\n    }\n    render() {\n        return <ConfigConsumer>{this.renderAnchor}</ConfigConsumer>;\n    }\n}\nAnchor.defaultProps = {\n    affix: true,\n    showInkInFixed: false,\n    getContainer: getDefaultContainer,\n};\nAnchor.childContextTypes = {\n    antAnchor: PropTypes.object,\n};\n"],"file":"Anchor.js"}